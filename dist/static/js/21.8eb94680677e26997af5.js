webpackJsonp([21],{caIZ:function(t,e){},mkHS:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r("f4AQ"),a={data:()=>({runBtnShow:!1,refreshBtnShow:!1,reportBtnShow:!1,currentStepSn:null,status:null,timer:null,loading:null}),components:{},mounted(){this.selectTask()},destroyed(){window.clearInterval(this.timer)},methods:{selectTask(){let t=new FormData;t.append("username",this.$store.state.username),t.append("p",this.$store.state.projectId),this.axios.post("/server/task_status",t).then(t=>{t.data.message.currentStepSn>-1?(this.runBtnShow=!1,this.refreshBtnShow=!0):(this.runBtnShow=!0,this.refreshBtnShow=!1),this.currentStepSn=t.data.message.currentStepSn,this.status=t.data.message.status,300===this.status&&(this.runBtnShow=!1,this.refreshBtnShow=!1,this.reportBtnShow=!0),this.runTask()})},runTask(){s.selectAll("svg")&&s.selectAll("svg").remove();var t={};t.currentStepSn=this.currentStepSn,t.status=this.status;var e=["FastQC","Mapping","Assembling","Quantification","DEG"],r={top:30,right:10,bottom:30,left:0},a=200,n=30;let i=s.select("#container").append("svg");var o=r.top+n+r.bottom,c=r.left+a*e.length+30*(e.length-1)+r.right;i.attr("height",o).attr("width",c);i.append("defs").append("marker").attr("id","arrow").attr("markerUnits","strokeWidth").attr("markerWidth","12").attr("markerHeight","12").attr("viewBox","0 0 12 12").attr("refX","6").attr("refY","6").attr("orient","auto").append("path").attr("d","M2,2 L10,6 L2,10 L6,6 L2,2").attr("fill","gray");i.selectAll("rect").data(e).enter().append("rect").attr("fill",function(e,r){return r<t.currentStepSn?"green":r==t.currentStepSn?"orange":"white"}).attr("stroke",function(e,r){return r<t.currentStepSn?"green":r==t.currentStepSn?"orange":"gray"}).attr("x",function(t,e){return r.left+e*(30+a)}).attr("y",function(t,e){return r.top}).attr("width",a).attr("height",n).attr("class",function(t,e){return t}),i.selectAll("text").data(e).enter().append("text").attr("fill","black").attr("font-size","14px").attr("font-weight","bold").attr("text-anchor","middle").attr("x",function(t,e){return r.left+e*(30+a)}).attr("y",function(t,e){return r.top}).attr("dx",a/2).attr("dy","1.5em").text(function(t,e){return t});var u=3;i.selectAll("line").data([1,1,1,1]).enter().append("line").attr("x1",function(t,e){return r.left+a*(e+1)+30*e+u}).attr("y1",r.top+n/2).attr("x2",function(t,e){return r.left+a*(e+1)+30*e+30-12}).attr("y2",r.top+n/2).attr("stroke","gray").attr("stroke-width",2).attr("marker-end","url(#arrow)");if(300!==t.status&&t.currentStepSn>=0){var h=1,l=a,p=n,d=r.top,f=i.select("."+e[t.currentStepSn]).attr("x"),m=f,S=1e3;setInterval(function(){i.selectAll("."+e[t.currentStepSn]).transition().duration(S).attr("width",function(t,e){return l=l==a?a+2*u:a}).attr("height",function(t,e){return p=p==n?n+2*u:n}).attr("y",function(t,e){return d=d==r.top?r.top-u:r.top}).attr("x",function(t,e){return m=m==f?f-u:f}).attr("opacity",function(t,e){return h=1==h?.5:1})},S)}},startTask(){let t=new FormData;t.append("username",this.$store.state.username),t.append("p",this.$store.state.projectId),this.axios.post("/server/task_run",t).then(t=>{"success"===t.data.message_type?(this.runBtnShow=!1,this.refreshBtnShow=!0,this.currentStepSn=t.data.message.currentStepSn,this.status=t.data.message.status,this.runTask()):this.$message.error("请求错误!")}).catch(t=>{this.$message.error("请求错误!")})},report(){this.loading=this.$loading({lock:!0,text:"报告正在生成中...请稍等...可能需要等待5~10分钟左右的时间...",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),this.axios.get("/server/create_report?username="+this.$store.state.username+"&p="+this.$store.state.projectId).then(t=>{"success"===t.data.message_type?this.getReportStatus():(this.loading.close(),this.$message.error("请求错误!"))}).catch(t=>{this.loading.close(),this.$message.error("请求错误!")})},getReportStatus(){this.timer=setInterval(()=>{this.axios.get("/server/create_report_status?username="+this.$store.state.username+"&p="+this.$store.state.projectId).then(t=>{300===t.data&&(this.loading.close(),this.$message.success("报告已生成!"),window.clearInterval(this.timer))})},15e3)},result(){},backProjectList(){this.$router.push({name:"project_list"})}}},n={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"content"},[r("el-tooltip",{staticClass:"item cursor-pointer",attrs:{effect:"dark",content:"返回",placement:"right"}},[r("i",{staticClass:"el-icon-back",on:{click:t.backProjectList}})]),t._v(" "),r("h3",[t._v("项目："+t._s(this.$store.state.projectName))]),t._v(" "),r("div",{attrs:{id:"container"}}),t._v(" "),r("div",{},[r("transition",{attrs:{name:"fade"}},[t.runBtnShow?r("el-button",{attrs:{type:"primary"},on:{click:function(e){t.startTask()}}},[t._v("运行分析任务")]):t._e(),t._v(" "),t.refreshBtnShow?r("el-button",{attrs:{type:"danger"},on:{click:function(e){t.selectTask()}}},[t._v("刷新任务状态")]):t._e()],1),t._v(" "),r("el-button",{directives:[{name:"show",rawName:"v-show",value:t.reportBtnShow,expression:"reportBtnShow"}],attrs:{type:"",plain:""},on:{click:function(e){t.report()}}},[r("i",{staticClass:"el-icon-document"}),t._v(" 生成报告")])],1)],1)},staticRenderFns:[]};var i=r("VU/8")(a,n,!1,function(t){r("caIZ")},"data-v-77d31cf7",null);e.default=i.exports}});
//# sourceMappingURL=21.8eb94680677e26997af5.js.map