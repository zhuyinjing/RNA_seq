webpackJsonp([6],{Mscf:function(t,e){},RlhH:function(t,e){},xDHS:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("Oj91"),r=a("f4AQ"),c={data:()=>({checkboxValue:[],checkAll:!1,checkedPCA:[],isIndeterminate:!1,tableValue:[],conditionArr:[],maxValue:[],minValue:[],nameSampleMap:{},percentVariance:[]}),components:{leftMenu:n.a},created(){this.getValue()},mounted(){},methods:{getValue(){this.axios.get("/server/pca4gene?username="+this.$store.state.username+"&p="+this.$store.state.projectId).then(t=>{this.maxValue=t.data.maxValue,this.minValue=t.data.minValue,this.percentVariance=t.data.pca4GeneExprMatrix.percentVariance,this.nameSampleMap=t.data.experimentDesign.nameSampleMap;for(let e=0;e<t.data.pca4GeneExprMatrix.percentVariance.length;e++)this.checkboxValue.push(e+1);this.checkedPCA=[this.checkboxValue[0],this.checkboxValue[1]];for(let e in t.data.experimentDesign.conditionNumMap)this.conditionArr.push(e);for(let e in t.data.pca4GeneExprMatrix.sampleCoordMap){let a={name:e,value:t.data.pca4GeneExprMatrix.sampleCoordMap[e]};this.tableValue.push(a)}this.initD3()})},handleCheckAllChange(t){this.checkedPCA=t?this.checkboxValue:[],this.isIndeterminate=!1},handlecheckedPCAChange(t){let e=t.length;this.checkAll=e===this.checkboxValue.length,this.isIndeterminate=e>0&&e<this.checkboxValue.length},initD3(){if(this.checkedPCA.length<2)return void this.$message("请至少选择2个选项！");r.selectAll(".d3svg")&&r.selectAll(".d3svg").remove();let t=this;var e=this.checkedPCA.length>8?100*this.checkedPCA.length:800,a=this.checkedPCA.length>8?100*this.checkedPCA.length:800,n=80,c=40,i=100,l=20,s=e-n-l,o=a-c-l,d=this.checkedPCA,h=e-n-l,u=a-c-l,p=r.scaleOrdinal(r.schemeCategory10),x=r.select(".container").append("svg").attr("class","d3svg").attr("width",s).attr("height",o).style("padding-left",n).style("padding-right",i).style("padding-top",c).style("padding-bottom",l);if(2===this.checkedPCA.length){var m=h,f=u;(V=x.append("g").attr("transform","translate(0,0)")).append("text").attr("x",m/2).attr("y",-20).attr("dy","-0.3em").text(function(){return"PC"+t.checkedPCA[0]}),V.append("text").attr("x",m/2).attr("y",-5).attr("dy","-0.3em").text(function(){return"("+(100*t.percentVariance[t.checkedPCA[0]-1]).toFixed(0)+"%)"}),V.append("text").attr("x",-60).attr("y",f/2).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+t.checkedPCA[1]}),V.append("text").attr("x",-60).attr("y",f/2+20).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*t.percentVariance[t.checkedPCA[1]-1]).toFixed(0)+"%)"});var k=r.scaleLinear().range([f,0]).domain([r.max([t.maxValue[t.checkedPCA[0]-1],t.maxValue[t.checkedPCA[1]-1]])+2,r.min([t.minValue[t.checkedPCA[0]-1],t.minValue[t.checkedPCA[1]-1]])-2]),g=r.axisLeft(k).ticks(3),A=(V.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(g).style("font-size","14px"),r.scaleLinear().range([0,m]).domain([r.min([t.minValue[t.checkedPCA[0]-1],t.minValue[t.checkedPCA[1]-1]])-2,r.max([t.maxValue[t.checkedPCA[0]-1],t.maxValue[t.checkedPCA[1]-1]])+2])),C=r.axisBottom(A).ticks(3);V.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+f+")").call(C).style("font-size","14px");function y(){return r.axisBottom(A).ticks(3)}function v(){return r.axisLeft(k).ticks(3)}V.append("g").attr("class","grid").attr("transform","translate(0,"+f+")").call(y().tickSize(-f).tickFormat("")),V.append("g").attr("class","grid").call(v().tickSize(-m).tickFormat(""));p=r.scaleOrdinal(r.schemeCategory10);(P=V.append("g")).selectAll("circle").data(t.tableValue).enter().append("circle").attr("cx",function(e,a){return A(e.value[t.checkedPCA[0]-1])}).attr("cy",function(e,a){return k(e.value[t.checkedPCA[1]-1])}).attr("r",function(t){return 10}).attr("fill",function(e){return p(t.nameSampleMap[e.name].condition)}).on("mouseover",function(a){r.select(this).attr("r",1.6*r.select(this).attr("r")),e.attr("x",function(){return A(a.value[t.checkedPCA[0]-1])}).attr("y",function(){return k(a.value[t.checkedPCA[1]-1])-1.6*r.select(this).attr("r")-20}).text(function(){return a.name}).attr("text-anchor","middle")}).on("mouseout",function(){r.select(this).attr("r",r.select(this).attr("r")/1.6),e.text("")});P.append("g");let e=V.append("text").text("").attr("font-size","14px")}else{m=h/t.checkedPCA.length,f=u/t.checkedPCA.length;for(let e=0;e<d.length;e++){for(let a=0;a<d.length;a++){var P,V=x.append("g").attr("transform","translate("+(a*m+0)+","+(e*f+0)+")");k=r.scaleLinear().range([f,0]).domain([r.max([t.maxValue[d[a]-1],t.maxValue[d[e]-1]])+2,r.min([t.minValue[d[a]-1],t.minValue[d[e]-1]])-2]),g=r.axisLeft(k).ticks(d.length>2?0:3),V.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(g).style("font-size","14px"),A=r.scaleLinear().range([0,m]).domain([r.min([t.minValue[d[a]-1],t.minValue[d[e]-1]])-2,r.max([t.maxValue[d[a]-1],t.maxValue[d[e]-1]])+2]),C=r.axisBottom(A).ticks(d.length>2?0:3),V.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+f+")").call(C).style("font-size","14px");function y(){return r.axisBottom(A).ticks(3)}function v(){return r.axisLeft(k).ticks(3)}V.append("g").attr("class","grid").attr("transform","translate(0,"+f+")").call(y().tickSize(-f).tickFormat("")),V.append("g").attr("class","grid").call(v().tickSize(-m).tickFormat("")),(P=V.append("g")).selectAll("circle").data(t.tableValue).enter().append("circle").attr("cx",function(t){return A(t.value[d[a]-1])}).attr("cy",function(t){return k(t.value[d[e]-1])}).attr("r",function(e){return t.checkedPCA.length>6?2:10/(d.length-1)}).attr("fill",function(e){return p(t.nameSampleMap[e.name].condition)}).on("mouseover",function(t){r.select(this).attr("r",1.6*r.select(this).attr("r")),n.attr("x",function(){return A(0)}).attr("y",function(){return k(0)}).text(function(){return t.name}).attr("text-anchor","middle")}).on("mouseout",function(){r.select(this).attr("r",r.select(this).attr("r")/1.6),n.text("")});P.append("g");let n=V.append("text").text("").attr("font-size","14px")}x.append("text").attr("x",m/2.5+e*m).attr("y",-15).attr("dy","-0.3em").text(function(){return"PC"+t.checkedPCA[e]}),x.append("text").attr("x",m/2.5+e*m).attr("y",-2).attr("dy","-0.3em").text(function(){return"("+(100*t.percentVariance[t.checkedPCA[e]-1]).toFixed(0)+"%)"}),x.append("text").attr("x",-60).attr("y",f/2+e*f).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+t.checkedPCA[e]}),x.append("text").attr("x",-60).attr("y",f/2+20+e*f).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*t.percentVariance[t.checkedPCA[e]-1]).toFixed(0)+"%)"})}}r.selectAll(".xaxis .domain").remove(),r.selectAll(".yaxis .domain").remove(),x.append("text").attr("x",s+10).attr("y",120).attr("dy","-0.3em").text(function(){return"group"});for(let e=0;e<t.conditionArr.length;e++)x.append("rect").attr("x",s+10).attr("y",130+30*e).attr("width",30).attr("height",30).attr("fill","white").attr("stroke","#999"),x.append("circle").attr("cx",s+10+15).attr("cy",130+30*e+15).attr("r",10).attr("fill",p(t.conditionArr[e])),x.append("text").attr("x",s+10+40).attr("y",155+30*e).attr("dy","-0.3em").text(t.conditionArr[e])}}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{},[a("leftMenu",{staticStyle:{float:"left",width:"300px","margin-top":"10px"}}),t._v(" "),a("div",{staticClass:"content"},[a("el-breadcrumb",{staticStyle:{margin:"5px 0 50px 0"},attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"report"}}},[t._v("项目 "+t._s(t.$store.state.projectName))]),t._v(" "),a("el-breadcrumb-item",[t._v("PCA 主成分分析")])],1),t._v(" "),a("h2",[t._v("PCA 主成分分析")]),t._v(" "),a("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")]),t._v(" "),a("div",{staticStyle:{margin:"15px 0"}}),t._v(" "),a("el-checkbox-group",{on:{change:t.handlecheckedPCAChange},model:{value:t.checkedPCA,callback:function(e){t.checkedPCA=e},expression:"checkedPCA"}},t._l(t.checkboxValue,function(e){return a("el-checkbox",{key:e,staticStyle:{width:"20%"},attrs:{label:e}},[t._v("PC"+t._s(e))])})),t._v(" "),a("br"),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.initD3()}}},[t._v("确定")]),t._v(" "),a("div",{staticClass:"container"})],1)],1)},staticRenderFns:[]};var l=a("VU/8")(c,i,!1,function(t){a("Mscf"),a("RlhH")},"data-v-f7f82430",null);e.default=l.exports}});
//# sourceMappingURL=6.85ddc9ab40081aecca27.js.map