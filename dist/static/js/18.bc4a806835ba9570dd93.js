webpackJsonp([18],{GwSV:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("Oj91"),n=a("SH1Y"),s=a("K0Oa"),l=a("f4AQ"),r={data:()=>({rangeShow:!1,showNum:3e3,arr:[],geneNameShow:!1,xLeft:1,yTop:0,xmin:0,xmax:8e3,ymin:-3,ymax:3,radius:1.8,width:800,height:605,pvalue:.05,FDR:.05,log2FoldChange:1}),components:{leftMenu:i.a,degComp:n.a,imgMenuShowComp:s.a},created(){this.pvalue=this.$store.state.degFilterArgs.pvalue,this.FDR=this.$store.state.degFilterArgs.FDR,this.log2FoldChange=this.$store.state.degFilterArgs.log2FoldChange},mounted(){this.getData(),this.$nextTick(function(){MathJax.Hub.Queue(["Typeset",MathJax.Hub])})},watch:{$route:"getDataReset"},methods:{getDataReset(){this.geneNameShow=!1,this.showNum=3e3,this.xLeft=1,this.yTop=2,this.xmin=-3,this.xmax=3,this.ymin=0,this.ymax=12,this.width=800,this.height=600,this.radius=1.5,this.getData()},getData(){let t=sessionStorage.getItem("_case"),e=sessionStorage.getItem("_control");this.axios.get("/server/ma_data?username="+this.$store.state.username+"&p="+this.$store.state.projectId+"&_case="+t+"&_control="+e+"&gene_num="+this.showNum).then(t=>{t.data.length>0?(t.data=t.data.slice(1),this.arr=t.data,this.rangeShow=!0,this.initD3(),this.xLeftChange()):this.$message({message:"暂无数据!",duration:1e3})})},backReport(){this.$router.push({name:"report"})},change(){l.selectAll(".red").attr("class","green")},initD3(){l.selectAll("svg")&&l.selectAll("svg").remove();let t=this,e=this.width,a=this.height,i=50,n=30,s=30,r=30,o=l.select("#d3container").append("svg").attr("id","svg").attr("width",e).attr("height",a),c=l.scaleLinear().domain([this.xmin-100,this.xmax]).range([0,e-i-n]),h=l.scaleLinear().domain([this.ymin-.2,this.ymax]).range([a-s-r,0]),d=l.select("body").append("div").style("position","absolute").style("z-index","10").style("color","#3497db").style("visibility","hidden").style("font-size","12px").style("font-weight","bold").text("");o.append("rect").attr("x",50).attr("y",0).attr("width",e-50).attr("height",a-30).attr("fill","none").attr("stroke","black"),o.append("line").attr("x1",i+c(t.xmin)).attr("y1",r+h(0)).attr("x2",2*i+c(t.xmax)).attr("y2",r+h(0)).attr("stroke","red");o.selectAll("circle").data(t.arr).enter().append("circle").filter(e=>e[2]>t.ymin&&e[2]<t.ymax).attr("cx",t=>i+c(t[1])).attr("cy",t=>r+h(t[2])).attr("r",t.radius).on("mouseover",function(t,e){return d.style("visibility","visible").text(t[5])}).on("mousemove",function(t,e){return d.style("top",l.event.pageY-10+"px").style("left",l.event.pageX+10+"px")}).on("mouseout",function(t,e){return d.style("visibility","hidden")});o.selectAll(".triangle").data(t.arr).enter().append("path").filter(e=>e[2]<t.ymin).attr("d",l.symbol().type(l.symbolTriangle).size(20)).attr("transform",function(e){return"translate("+(i+c(e[1]))+","+(r+h(t.ymin))+")rotate(180)"}).attr("fill","none").attr("stroke",(e,a)=>Math.abs(e[2])>=t.log2FoldChange&&e[3]<=t.pvalue&&e[4]<=t.FDR?"red":"black").on("mouseover",function(t,e){return d.style("visibility","visible").text(t[5])}).on("mousemove",function(t,e){return d.style("top",l.event.pageY-10+"px").style("left",l.event.pageX+10+"px")}).on("mouseout",function(t,e){return d.style("visibility","hidden")}),o.selectAll(".triangle").data(t.arr).enter().append("path").filter(e=>e[2]>t.ymax).attr("d",l.symbol().type(l.symbolTriangle).size(20)).attr("transform",function(e){return"translate("+(i+c(e[1]))+","+(r+h(t.ymax))+")"}).attr("fill","none").attr("stroke",(e,a)=>Math.abs(e[2])>=t.log2FoldChange&&e[3]<=t.pvalue&&e[4]<=t.FDR?"red":"black").on("mouseover",function(t,e){return d.style("visibility","visible").text(t[5])}).on("mousemove",function(t,e){return d.style("top",l.event.pageY-10+"px").style("left",l.event.pageX+10+"px")}).on("mouseout",function(t,e){return d.style("visibility","hidden")});let u=l.axisBottom().scale(c),m=l.axisLeft().scale(h);o.append("g").attr("class","axis").attr("transform","translate("+i+","+(a-r)+")").call(u).append("text").text("baseMean").attr("fill","#000").style("font-size","14px").attr("transform","translate("+e/2.2+", 30)"),o.append("g").attr("class","axis").attr("transform","translate("+i+","+s+")").call(m),o.append("text").text("log2FoldChange").attr("fill","#000").attr("transform","translate(15, "+a/2+") rotate(-90)"),l.selectAll(".domain").remove(),!0===t.geneNameShow&&o.selectAll("text").data(t.arr).enter().append("text").filter(e=>{if(Math.abs(e[2])>=t.log2FoldChange)return e[3]<=t.pvalue&&e[4]<=t.FDR}).text(t=>t[5]).attr("x",t=>i+c(t[1])+5).attr("y",t=>r+h(t[2])).attr("fill","#3497db").style("font-size","6px").style("font-weight","bold"),0===t.xLeft&&0===t.yTop||t.circleColor(),l.selectAll(".red").style("fill","red")},xLeftChange(){let t=this;l.selectAll("circle").classed("red",(e,a)=>{if(Math.abs(e[2])>=t.log2FoldChange)return e[3]<=t.pvalue&&e[4]<=t.FDR});this.initD3()},circleColor(){let t=this;l.selectAll("circle").classed("red",(e,a)=>{if(Math.abs(e[2])>=t.log2FoldChange)return e[3]<=t.pvalue&&e[4]<=t.FDR})},xvaluechange(){this.initD3()}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-container",{staticStyle:{height:"calc(100% - 62px)","margin-top":"2px"}},[a("el-aside",{directives:[{name:"show",rawName:"v-show",value:t.$store.state.menuShow,expression:"$store.state.menuShow"}],staticStyle:{width:"300px",height:"100%","border-right":"1px solid #e6e6e6"},attrs:{width:"350px;"}},[a("leftMenu",{staticStyle:{"margin-top":"5px"}})],1),t._v(" "),a("el-main",[a("imgMenuShowComp"),t._v(" "),a("degComp"),t._v(" "),a("div",{},[a("p",[t._v("MA plot 展示了基因在样本间的表达量丰度和表达量变化之间的关系。MA plot 的 X 轴是基因在比对的两类样本中的丰度平均值，Y 轴是为 log2(表达差异倍数取)，Y 轴是在衡量基因表达量的变化，表明一个基因在实验组中上调还是下调。例如 A vs B 的差异表达基因 G，在样本 A 中的表达量为 500，在样本 B 中的表达量为 2000，则 X 轴坐标为是\n      ")]),a("p",[t._v("$$  \\frac{500 + 2000}{2} = 1250 $$")]),t._v("\n      Y 轴坐标为\n      "),a("p",[t._v("$$ \\log_{2}{\\frac{500}{2000}} = -2 $$")]),t._v(" "),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-picture"},on:{click:function(e){t.$store.commit("d3saveSVG","MA plot")}}},[t._v("生成 SVG")]),t._v(" "),a("i",{staticClass:"el-icon-question cursor-pointer",staticStyle:{"font-size":"16px"},on:{click:function(e){t.$store.state.svgDescribeShow=!0}}}),t._v(" "),a("div",{staticClass:"min-width-div"},[a("div",{staticClass:"display-inline-block vertical-align-top",attrs:{id:"d3container"}}),t._v(" "),a("div",{staticClass:"clear"}),t._v(" "),a("table",{directives:[{name:"show",rawName:"v-show",value:t.rangeShow,expression:"rangeShow"}],staticClass:"gridtable"},[a("tr",[a("th",[t._v("参数")]),a("th",[t._v("操作")])]),t._v(" "),a("tr",[a("td",[t._v("pvalue ≤")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",step:.1},on:{change:t.xLeftChange},model:{value:t.pvalue,callback:function(e){t.pvalue=e},expression:"pvalue"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("FDR ≤")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",step:.1},on:{change:t.xLeftChange},model:{value:t.FDR,callback:function(e){t.FDR=e},expression:"FDR"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("Log2FoldChange (绝对值) ≥")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",step:.1},on:{change:t.xLeftChange},model:{value:t.log2FoldChange,callback:function(e){t.log2FoldChange=e},expression:"log2FoldChange"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("是否显示基因名")]),t._v(" "),a("td",[a("el-switch",{staticStyle:{display:"block"},attrs:{"active-color":"#409EFF","inactive-color":"#e4e7ed"},on:{change:t.initD3},model:{value:t.geneNameShow,callback:function(e){t.geneNameShow=e},expression:"geneNameShow"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("显示基因个数")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",min:0,label:"描述文字"},on:{change:t.getData},model:{value:t.showNum,callback:function(e){t.showNum=e},expression:"showNum"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("x轴最小值")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",min:0},on:{change:t.initD3},model:{value:t.xmin,callback:function(e){t.xmin=e},expression:"xmin"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("x轴最大值")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini"},on:{change:t.initD3},model:{value:t.xmax,callback:function(e){t.xmax=e},expression:"xmax"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("y轴最小值")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini"},on:{change:t.initD3},model:{value:t.ymin,callback:function(e){t.ymin=e},expression:"ymin"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("y轴最大值")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini"},on:{change:t.initD3},model:{value:t.ymax,callback:function(e){t.ymax=e},expression:"ymax"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("宽")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini"},on:{change:t.initD3},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("高")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini"},on:{change:t.initD3},model:{value:t.height,callback:function(e){t.height=e},expression:"height"}})],1)]),t._v(" "),a("tr",[a("td",[t._v("点的半径")]),t._v(" "),a("td",[a("el-input-number",{attrs:{size:"mini",min:0,step:.1},on:{change:t.initD3},model:{value:t.radius,callback:function(e){t.radius=e},expression:"radius"}})],1)])])])],1)],1)],1)},staticRenderFns:[]};var c=a("VU/8")(r,o,!1,function(t){a("c8JT"),a("OHk9")},"data-v-0bac5fc7",null);e.default=c.exports},OHk9:function(t,e){},c8JT:function(t,e){}});
//# sourceMappingURL=18.bc4a806835ba9570dd93.js.map