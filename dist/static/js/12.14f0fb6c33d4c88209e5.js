webpackJsonp([12],{TKpK:function(e,t){},r1bv:function(e,t){},xDHS:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Oj91"),r=a("K0Oa"),i=a("f4AQ"),c={data:()=>({checkboxValue:[],checkAll:!1,checkedPCA:[],isIndeterminate:!1,tableValue:[],conditionArr:[],maxValue:[],minValue:[],nameSampleMap:{},percentVariance:[],radius:6,opacity:.7}),components:{leftMenu:n.a,imgMenuShowComp:r.a},created(){this.getValue()},mounted(){},methods:{getValue(){this.axios.get("/server/pca4gene?username="+this.$store.state.username+"&p="+this.$store.state.projectId).then(e=>{this.maxValue=e.data.maxValue,this.minValue=e.data.minValue,this.percentVariance=e.data.pca4GeneExprMatrix.percentVariance,this.nameSampleMap=e.data.experimentDesign.nameSampleMap;for(let t=0;t<e.data.pca4GeneExprMatrix.percentVariance.length;t++)this.checkboxValue.push(t+1);this.checkedPCA=[this.checkboxValue[0],this.checkboxValue[1]];for(let t in e.data.experimentDesign.conditionNumMap)this.conditionArr.push(t);for(let t in e.data.pca4GeneExprMatrix.sampleCoordMap){let a={name:t,value:e.data.pca4GeneExprMatrix.sampleCoordMap[t]};this.tableValue.push(a)}this.initD3()})},handleCheckAllChange(e){this.checkedPCA=e?this.checkboxValue:[],this.isIndeterminate=!1},handlecheckedPCAChange(e){let t=e.length;this.checkAll=t===this.checkboxValue.length,this.isIndeterminate=t>0&&t<this.checkboxValue.length},clearChecked(){this.$confirm("此操作将清空您的选项, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.checkedPCA=[]}).catch(()=>{})},initD3(){if(this.checkedPCA.length<2)return void this.$message("请至少选择2个PC！");if(this.checkedPCA.length>10)return void this.$message("最多选择10个PC，请修改您的选项！");i.selectAll(".d3pcasvg")&&i.selectAll(".d3pcasvg").remove();let e=this;var t=this.checkedPCA.length>8?100*this.checkedPCA.length:800,a=this.checkedPCA.length>8?100*this.checkedPCA.length:800,n=80,r=40,c=20,l=t-n-c,s=a-r-c,o=this.checkedPCA,d=t-n-c,p=a-r-c,u=i.scaleOrdinal(i.schemeCategory20);let h=i.select("body").append("div").style("position","absolute").style("z-index","10").style("visibility","hidden").style("font-size","14px").style("font-weight","bold").text("");var m=i.select(".container").append("svg").attr("class","d3pcasvg").attr("width",l).attr("height",s);if(2===this.checkedPCA.length){var x=d,f=p;(V=m.append("g").attr("transform","translate(0,0)")).append("text").attr("x",x/2).attr("y",-20).attr("dy","-0.3em").text(function(){return"PC"+e.checkedPCA[0]}),V.append("text").attr("x",x/2).attr("y",-5).attr("dy","-0.3em").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[0]-1]).toFixed(0)+"%)"}),V.append("text").attr("x",-60).attr("y",f/2).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+e.checkedPCA[1]}),V.append("text").attr("x",-60).attr("y",f/2+20).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[1]-1]).toFixed(0)+"%)"});var g=i.scaleLinear().range([f,0]).domain([i.max([e.maxValue[e.checkedPCA[0]-1],e.maxValue[e.checkedPCA[1]-1]])+2,i.min([e.minValue[e.checkedPCA[0]-1],e.minValue[e.checkedPCA[1]-1]])-2]),y=i.axisLeft(g).ticks(3),k=(V.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(y).style("font-size","14px"),i.scaleLinear().range([0,x]).domain([i.min([e.minValue[e.checkedPCA[0]-1],e.minValue[e.checkedPCA[1]-1]])-2,i.max([e.maxValue[e.checkedPCA[0]-1],e.maxValue[e.checkedPCA[1]-1]])+2])),v=i.axisBottom(k).ticks(3);V.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+f+")").call(v).style("font-size","14px");function C(){return i.axisBottom(k).ticks(3)}function A(){return i.axisLeft(g).ticks(3)}V.append("g").attr("class","grid").attr("transform","translate(0,"+f+")").call(C().tickSize(-f).tickFormat("")),V.append("g").attr("class","grid").call(A().tickSize(-x).tickFormat(""));u=i.scaleOrdinal(i.schemeCategory20);V.append("g").selectAll("circle").data(e.tableValue).enter().append("circle").attr("cx",function(t,a){return k(t.value[e.checkedPCA[0]-1])}).attr("cy",function(t,a){return g(t.value[e.checkedPCA[1]-1])}).attr("r",e.radius).attr("fill",function(t){return u(u(e.nameSampleMap[t.name].condition))}).style("opacity",e.opacity).on("mouseover",(e,t)=>h.style("visibility","visible").text(e.name)).on("mousemove",function(e,t){return h.style("top",i.event.pageY-10+"px").style("left",i.event.pageX+10+"px")}).on("mouseout",function(e,t){return h.style("visibility","hidden")})}else{x=d/e.checkedPCA.length,f=p/e.checkedPCA.length;for(let t=0;t<o.length;t++){for(let a=0;a<o.length;a++){var V=m.append("g").attr("transform","translate("+(a*x+0)+","+(t*f+0)+")");g=i.scaleLinear().range([f,0]).domain([i.max([e.maxValue[o[a]-1],e.maxValue[o[t]-1]])+2,i.min([e.minValue[o[a]-1],e.minValue[o[t]-1]])-2]),y=i.axisLeft(g).ticks(o.length>2?0:3),V.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(y).style("font-size","14px"),k=i.scaleLinear().range([0,x]).domain([i.min([e.minValue[o[a]-1],e.minValue[o[t]-1]])-2,i.max([e.maxValue[o[a]-1],e.maxValue[o[t]-1]])+2]),v=i.axisBottom(k).ticks(o.length>2?0:3),V.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+f+")").call(v).style("font-size","14px");function C(){return i.axisBottom(k).ticks(3)}function A(){return i.axisLeft(g).ticks(3)}V.append("g").attr("class","grid").attr("transform","translate(0,"+f+")").call(C().tickSize(-f).tickFormat("")),V.append("g").attr("class","grid").call(A().tickSize(-x).tickFormat("")),V.append("g").selectAll("circle").data(e.tableValue).enter().append("circle").attr("cx",function(e){return k(e.value[o[a]-1])}).attr("cy",function(e){return g(e.value[o[t]-1])}).attr("r",function(t){return e.radius}).attr("fill",function(t){return u(e.nameSampleMap[t.name].condition)}).style("opacity",e.opacity).on("mouseover",(e,t)=>h.style("visibility","visible").text(e.name)).on("mousemove",function(e,t){return h.style("top",i.event.pageY-10+"px").style("left",i.event.pageX+10+"px")}).on("mouseout",function(e,t){return h.style("visibility","hidden")})}m.append("text").attr("x",x/2.5+t*x).attr("y",-15).attr("dy","-0.3em").text(function(){return"PC"+e.checkedPCA[t]}),m.append("text").attr("x",x/2.5+t*x).attr("y",-2).attr("dy","-0.3em").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[t]-1]).toFixed(0)+"%)"}),m.append("text").attr("x",-60).attr("y",f/2+t*f).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+e.checkedPCA[t]}),m.append("text").attr("x",-60).attr("y",f/2+20+t*f).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[t]-1]).toFixed(0)+"%)"})}}i.selectAll(".xaxis .domain").remove(),i.selectAll(".yaxis .domain").remove(),m.append("text").attr("x",l+10).attr("y",20).attr("dy","-0.3em").text(function(){return"group"});for(let t=0;t<e.conditionArr.length;t++)m.append("rect").attr("x",l+10).attr("y",25+30*t).attr("width",30).attr("height",30).attr("fill","white").attr("stroke","#999"),m.append("circle").attr("cx",l+10+15).attr("cy",25+30*t+15).attr("r",8).attr("fill",u(e.conditionArr[t])),m.append("text").attr("x",l+10+40).attr("y",50+30*t).attr("dy","-0.3em").text(e.conditionArr[t])}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticStyle:{height:"calc(100% - 62px)","margin-top":"2px"}},[a("el-aside",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.menuShow,expression:"$store.state.menuShow"}],staticStyle:{width:"300px",height:"100%","border-right":"1px solid #e6e6e6"},attrs:{width:"350px;"}},[a("leftMenu",{staticStyle:{"margin-top":"5px"}})],1),e._v(" "),a("el-main",[a("div",{},[a("imgMenuShowComp"),e._v(" "),a("el-breadcrumb",{staticStyle:{margin:"5px 0 50px 0"},attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"report"}}},[e._v("项目 "+e._s(e.$store.state.projectName))]),e._v(" "),a("el-breadcrumb-item",[e._v("PCA 主成分分析")])],1),e._v(" "),a("h2",[e._v("PCA 主成分分析")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handlecheckedPCAChange},model:{value:e.checkedPCA,callback:function(t){e.checkedPCA=t},expression:"checkedPCA"}},e._l(e.checkboxValue,function(t,n){return a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.percentVariance[n]>.01,expression:"percentVariance[index] > 0.01?true:false"}],key:t,staticStyle:{width:"20%"},attrs:{label:t}},[e._v("PC"+e._s(t)+" ( "+e._s((100*e.percentVariance[n]).toFixed(0))+"% )")])})),e._v(" "),a("br"),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.initD3()}}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:function(t){e.clearChecked()}}},[e._v("清空")]),e._v("\n         \n      点的半径："),a("el-input-number",{attrs:{size:"mini",step:1,min:0},on:{change:function(t){e.initD3()}},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}}),e._v("\n         \n      点透明度："),a("el-input-number",{attrs:{size:"mini",step:.1,min:0},on:{change:function(t){e.initD3()}},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}}),e._v(" "),a("div",{staticClass:"container margin-top-10"})],1)])],1)},staticRenderFns:[]};var s=a("VU/8")(c,l,!1,function(e){a("TKpK"),a("r1bv")},"data-v-9b2bee60",null);t.default=s.exports}});
//# sourceMappingURL=12.14f0fb6c33d4c88209e5.js.map