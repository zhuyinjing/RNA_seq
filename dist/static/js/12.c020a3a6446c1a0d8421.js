webpackJsonp([12],{"7SHS":function(e,t){},veeB:function(e,t){},xDHS:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("Oj91"),i=a("K0Oa"),r=a("f4AQ"),c={data:()=>({checkboxValue:[],checkAll:!1,checkedPCA:[],isIndeterminate:!1,tableValue:[],conditionArr:[],maxValue:[],minValue:[],nameSampleMap:{},percentVariance:[],radius:6,opacity:.7}),components:{leftMenu:n.a,imgMenuShowComp:i.a},created(){this.getValue()},mounted(){},methods:{getValue(){this.axios.get("/server/pca4gene?username="+this.$store.state.username+"&p="+this.$store.state.projectId).then(e=>{this.maxValue=e.data.maxValue,this.minValue=e.data.minValue,this.percentVariance=e.data.pca4GeneExprMatrix.percentVariance,this.nameSampleMap=e.data.experimentDesign.nameSampleMap;for(let t=0;t<e.data.pca4GeneExprMatrix.percentVariance.length;t++)this.checkboxValue.push(t+1);this.checkedPCA=[this.checkboxValue[0],this.checkboxValue[1]];for(let t in e.data.experimentDesign.conditionNumMap)this.conditionArr.push(t);for(let t in e.data.pca4GeneExprMatrix.sampleCoordMap){let a={name:t,value:e.data.pca4GeneExprMatrix.sampleCoordMap[t]};this.tableValue.push(a)}this.initD3()})},handleCheckAllChange(e){this.checkedPCA=e?this.checkboxValue:[],this.isIndeterminate=!1},handlecheckedPCAChange(e){let t=e.length;this.checkAll=t===this.checkboxValue.length,this.isIndeterminate=t>0&&t<this.checkboxValue.length},clearChecked(){this.$confirm("此操作将清空您的选项, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.checkedPCA=[]}).catch(()=>{})},initD3(){if(this.checkedPCA.length<2)return void this.$message("请至少选择2个PC！");if(this.checkedPCA.length>10)return void this.$message("最多选择10个PC，请修改您的选项！");r.selectAll(".d3pcasvg")&&r.selectAll(".d3pcasvg").remove();let e=this;var t=this.checkedPCA.length>8?100*this.checkedPCA.length:800,a=this.checkedPCA.length>8?100*this.checkedPCA.length:800,n=80,i=50,c=150,l=20,s=t+c,o=a+l,d=this.checkedPCA,p=t-n-l,u=a-i-l,h=r.scaleOrdinal(r.schemeCategory20);let m=r.select("body").append("div").style("position","absolute").style("z-index","10").style("visibility","hidden").style("font-size","14px").style("font-weight","bold").text("");var x=r.select("#d3container").append("svg").attr("class","d3pcasvg").attr("width",s).attr("height",o);if(2===this.checkedPCA.length){var f=p,y=u;(P=x.append("g").attr("transform","translate("+n+","+i+")")).append("text").attr("x",f/2).attr("y",-20).attr("dy","-0.3em").text(function(){return"PC"+e.checkedPCA[0]}),P.append("text").attr("x",f/2).attr("y",-5).attr("dy","-0.3em").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[0]-1]).toFixed(0)+"%)"}),P.append("text").attr("x",-60).attr("y",y/2).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+e.checkedPCA[1]}),P.append("text").attr("x",-60).attr("y",y/2+20).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[1]-1]).toFixed(0)+"%)"});var k=r.scaleLinear().range([y,0]).domain([r.max([e.maxValue[e.checkedPCA[0]-1],e.maxValue[e.checkedPCA[1]-1]])+2,r.min([e.minValue[e.checkedPCA[0]-1],e.minValue[e.checkedPCA[1]-1]])-2]),g=r.axisLeft(k).ticks(3),v=(P.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(g).style("font-size","14px"),r.scaleLinear().range([0,f]).domain([r.min([e.minValue[e.checkedPCA[0]-1],e.minValue[e.checkedPCA[1]-1]])-2,r.max([e.maxValue[e.checkedPCA[0]-1],e.maxValue[e.checkedPCA[1]-1]])+2])),C=r.axisBottom(v).ticks(3);P.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+y+")").call(C).style("font-size","14px");function A(){return r.axisBottom(v).ticks(3)}function V(){return r.axisLeft(k).ticks(3)}P.append("g").attr("class","grid").attr("transform","translate(0,"+y+")").call(A().tickSize(-y).tickFormat("")),P.append("g").attr("class","grid").call(V().tickSize(-f).tickFormat(""));h=r.scaleOrdinal(r.schemeCategory20);P.append("g").selectAll("circle").data(e.tableValue).enter().append("circle").attr("cx",function(t,a){return v(t.value[e.checkedPCA[0]-1])}).attr("cy",function(t,a){return k(t.value[e.checkedPCA[1]-1])}).attr("r",e.radius).attr("fill",function(t){return h(h(e.nameSampleMap[t.name].condition))}).style("opacity",e.opacity).on("mouseover",(e,t)=>m.style("visibility","visible").text(e.name)).on("mousemove",function(e,t){return m.style("top",r.event.pageY-10+"px").style("left",r.event.pageX+10+"px")}).on("mouseout",function(e,t){return m.style("visibility","hidden")})}else{f=p/e.checkedPCA.length,y=u/e.checkedPCA.length;for(let t=0;t<d.length;t++){for(let a=0;a<d.length;a++){var P=x.append("g").attr("transform","translate("+(a*f+n)+","+(t*y+i)+")");k=r.scaleLinear().range([y,0]).domain([r.max([e.maxValue[d[a]-1],e.maxValue[d[t]-1]])+2,r.min([e.minValue[d[a]-1],e.minValue[d[t]-1]])-2]),g=r.axisLeft(k).ticks(d.length>2?0:3),P.append("g").attr("class","yaxis").attr("transform","translate(0,0)").call(g).style("font-size","14px"),v=r.scaleLinear().range([0,f]).domain([r.min([e.minValue[d[a]-1],e.minValue[d[t]-1]])-2,r.max([e.maxValue[d[a]-1],e.maxValue[d[t]-1]])+2]),C=r.axisBottom(v).ticks(d.length>2?0:3),P.append("g").attr("class","xaxis").attr("transform","translate(0 ,"+y+")").call(C).style("font-size","14px");function A(){return r.axisBottom(v).ticks(3)}function V(){return r.axisLeft(k).ticks(3)}P.append("g").attr("class","grid").attr("transform","translate(0,"+y+")").call(A().tickSize(-y).tickFormat("")),P.append("g").attr("class","grid").call(V().tickSize(-f).tickFormat("")),P.append("g").selectAll("circle").data(e.tableValue).enter().append("circle").attr("cx",function(e){return v(e.value[d[a]-1])}).attr("cy",function(e){return k(e.value[d[t]-1])}).attr("r",function(t){return e.radius}).attr("fill",function(t){return h(e.nameSampleMap[t.name].condition)}).style("opacity",e.opacity).on("mouseover",(e,t)=>m.style("visibility","visible").text(e.name)).on("mousemove",function(e,t){return m.style("top",r.event.pageY-10+"px").style("left",r.event.pageX+10+"px")}).on("mouseout",function(e,t){return m.style("visibility","hidden")})}x.append("text").attr("x",f/2.5+t*f+n).attr("y",-15+i).attr("dy","-0.3em").text(function(){return"PC"+e.checkedPCA[t]}),x.append("text").attr("x",f/2.5+t*f+n).attr("y",-2+i).attr("dy","-0.3em").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[t]-1]).toFixed(0)+"%)"}),x.append("text").attr("x",-60+n).attr("y",y/2+t*y+i).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"PC"+e.checkedPCA[t]}),x.append("text").attr("x",-60+n).attr("y",y/2+20+t*y+i).attr("dy","-0.3em").style("text-anchor","start").text(function(){return"("+(100*e.percentVariance[e.checkedPCA[t]-1]).toFixed(0)+"%)"})}}r.selectAll(".xaxis .domain").remove(),r.selectAll(".yaxis .domain").remove(),x.append("text").attr("x",s-c+10).attr("y",i+20).attr("dy","-0.3em").text(function(){return"group"});for(let t=0;t<e.conditionArr.length;t++)x.append("rect").attr("x",s-c+10).attr("y",i+25+30*t).attr("width",30).attr("height",30).attr("fill","white").attr("stroke","#999"),x.append("circle").attr("cx",s-c+10+15).attr("cy",i+(25+30*t)+15).attr("r",8).attr("fill",h(e.conditionArr[t])),x.append("text").attr("x",s-c+10+40).attr("y",i+50+30*t).attr("dy","-0.3em").text(e.conditionArr[t]);r.selectAll(".tick").selectAll("line").style("stroke","#cccccc4d")}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",{staticStyle:{height:"calc(100% - 62px)","margin-top":"2px"}},[a("el-aside",{directives:[{name:"show",rawName:"v-show",value:e.$store.state.menuShow,expression:"$store.state.menuShow"}],staticStyle:{width:"300px",height:"100%","border-right":"1px solid #e6e6e6"},attrs:{width:"350px;"}},[a("leftMenu",{staticStyle:{"margin-top":"5px"}})],1),e._v(" "),a("el-main",[a("div",{},[a("imgMenuShowComp"),e._v(" "),a("el-breadcrumb",{staticStyle:{margin:"5px 0 50px 0"},attrs:{separator:"/"}},[a("el-breadcrumb-item",{attrs:{to:{path:"report"}}},[e._v("项目 "+e._s(e.$store.state.projectName))]),e._v(" "),a("el-breadcrumb-item",[e._v("PCA 主成分分析")])],1),e._v(" "),a("h2",[e._v("PCA 主成分分析")]),e._v(" "),a("el-checkbox-group",{on:{change:e.handlecheckedPCAChange},model:{value:e.checkedPCA,callback:function(t){e.checkedPCA=t},expression:"checkedPCA"}},e._l(e.checkboxValue,function(t,n){return a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.percentVariance[n]>.01,expression:"percentVariance[index] > 0.01?true:false"}],key:t,staticStyle:{width:"20%"},attrs:{label:t}},[e._v("PC"+e._s(t)+" ( "+e._s((100*e.percentVariance[n]).toFixed(0))+"% )")])})),e._v(" "),a("br"),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.initD3()}}},[e._v("确定")]),e._v(" "),a("el-button",{attrs:{type:"info",size:"small"},on:{click:function(t){e.clearChecked()}}},[e._v("清空")]),e._v("\n         \n      点的半径："),a("el-input-number",{attrs:{size:"mini",step:1,min:0},on:{change:function(t){e.initD3()}},model:{value:e.radius,callback:function(t){e.radius=t},expression:"radius"}}),e._v("\n         \n      点透明度："),a("el-input-number",{attrs:{size:"mini",step:.1,min:0},on:{change:function(t){e.initD3()}},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}}),e._v(" \n      "),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-document"},on:{click:function(t){e.$store.commit("d3savePDF","样本聚类")}}},[e._v("生成 PDF")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-picture"},on:{click:function(t){e.$store.commit("d3saveSVG","样本聚类")}}},[e._v("生成 SVG")]),e._v(" "),a("div",{staticClass:"margin-top-10",attrs:{id:"d3container"}})],1)])],1)},staticRenderFns:[]};var s=a("VU/8")(c,l,!1,function(e){a("7SHS"),a("veeB")},"data-v-65463ea8",null);t.default=s.exports}});
//# sourceMappingURL=12.c020a3a6446c1a0d8421.js.map